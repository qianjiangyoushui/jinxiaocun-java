<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Backmoney">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 条件语句 -->
	<sql id="WhereSQL">
		<where>
			<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
			</if>
			<if test="backmoney != null and backmoney != ''"> 
			AND T.BACKMONEY = #{backmoney} 
			</if>
			<if test="backdate != null and backdate != ''"> 
			AND T.BACKDATE = #{backdate} 
			</if>
			<if test="backtype != null and backtype != ''"> 
			AND T.BACKTYPE = #{backtype} 
			</if>
			<if test="description != null and description != ''"> 
			AND T.DESCRIPTION = #{description} 
			</if>
			<if test="operateid != null and operateid != ''"> 
			AND T.OPERATEID = #{operateid} 
			</if>
			<if test="createtime != null and createtime != ''"> 
			AND T.CREATETIME = #{createtime} 
			</if>
			<if test="lastupdatetime != null and lastupdatetime != ''"> 
			AND T.LASTUPDATETIME = #{lastupdatetime} 
			</if>
			<if test="companyid != null and companyid != ''"> 
			AND T.COMPANYID = #{companyid} 
			</if>
			<if test="companyname != null and companyname != ''"> 
			AND T.COMPANYNAME = #{companyname} 
			</if>
			<if test="del != null and del != ''"> 
			AND T.DEL = #{del} 
			</if>
			<if test="stockcompanyid != null and stockcompanyid != ''"> 
			AND T.stockcompanyid = #{stockcompanyid} 
			</if>
		</where>
	</sql>
	
	<!-- 查找语句 -->
	<select id="find" resultType="Backmoney" parameterType="Backmoney" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.BACKMONEY AS backmoney, 
	    	T.BACKDATE AS backdate, 
	    	T.BACKTYPE AS backtype, 
	    	T.DESCRIPTION AS description, 
	    	T.OPERATEID AS operateid, 
	    	T.CREATETIME AS createtime, 
	    	T.LASTUPDATETIME AS lastupdatetime, 
	    	T.COMPANYID AS companyid, 
	    	T.COMPANYNAME AS companyname, 
	    	T.DEL AS del ,
	    	T.stockcompanyid as stockcompanyid 
    	FROM backmoney T
		<include refid="WhereSQL" />
		ORDER BY T.BACKDATE  
	</select>
	
	<!-- 查找语句 -->
	<select id="countBackmoney" resultType="Backmoney" parameterType="Backmoney" flushCache="false" useCache="true">
    	select 
		distinct(p.stockcompanyid) as stockcompanyid,
		c.shortname as stockcompany,
		(select sum(b.backmoney)  from backmoney b where 
		b.stockcompanyid=p.stockcompanyid and b.companyid=#{companyid} group by b.stockcompanyid) as backmoney 
		from projects p 
		left join company c 
		on p.stockcompanyid =c.guid 
		where p.companyid=#{companyid} 
	</select>
	
	
	<!-- 获取总记录数语句 -->
	<select id="findCountBack" resultType="java.lang.Integer" parameterType="Backmoney" flushCache="false" useCache="true">
    	select  
		count(distinct(p.stockcompanyid))  
		from projects p 
		left join company c 
		on p.stockcompanyid=c.guid 
		left join backmoney b 
		on p.stockcompanyid = b.stockcompanyid 
		where p.companyid=#{companyid}
	</select>
	
	<!-- 获取总记录数语句 -->
	<select id="findCount" resultType="java.lang.Integer" parameterType="Backmoney" flushCache="false" useCache="true">
    	SELECT COUNT(*)  FROM backmoney T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 插入语句 -->
	<insert id="insert" parameterType="Backmoney" flushCache="true"> 
		INSERT INTO backmoney
		(
			GUID, 
			BACKMONEY, 
			BACKDATE, 
			BACKTYPE, 
			DESCRIPTION, 
			OPERATEID, 
			CREATETIME, 
			LASTUPDATETIME, 
			COMPANYID, 
			COMPANYNAME, 
			DEL ,
			stockcompanyid 
		 ) 
		VALUES
		(
			#{guid,jdbcType=VARCHAR}, 
			#{backmoney,jdbcType=DECIMAL}, 
			#{backdate,jdbcType=DATE}, 
			#{backtype,jdbcType=VARCHAR}, 
			#{description,jdbcType=VARCHAR}, 
			#{operateid,jdbcType=VARCHAR}, 
			#{createtime,jdbcType=TIMESTAMP}, 
			#{lastupdatetime,jdbcType=TIMESTAMP}, 
			#{companyid,jdbcType=VARCHAR}, 
			#{companyname,jdbcType=VARCHAR}, 
			#{del,jdbcType=VARCHAR} ,
			#{stockcompanyid,jdbcType=VARCHAR} 
		) 
	</insert>
	
	<!-- 更新语句 -->
	<update id="update"  parameterType="Backmoney" flushCache="true"> 
		update backmoney 
		<set> 
			<if test="guid != null">GUID=#{guid},</if>
			<if test="backmoney != null">BACKMONEY=#{backmoney},</if>
			<if test="backdate != null">BACKDATE=#{backdate},</if>
			<if test="backtype != null">BACKTYPE=#{backtype},</if>
			<if test="description != null">DESCRIPTION=#{description},</if>
			<if test="operateid != null">OPERATEID=#{operateid},</if>
			<if test="createtime != null">CREATETIME=#{createtime},</if>
			<if test="lastupdatetime != null">LASTUPDATETIME=#{lastupdatetime},</if>
			<if test="companyid != null">COMPANYID=#{companyid},</if>
			<if test="companyname != null">COMPANYNAME=#{companyname},</if>
			<if test="del != null">DEL=#{del},</if>
			<if test="stockcompanyid != null">stockcompanyid=#{stockcompanyid},</if>
		</set>
		WHERE GUID = #{guid}
	</update> 
	
	<!-- 单选删除语句 -->
	<delete id="delete" parameterType="Backmoney" flushCache="true"> 
		DELETE FROM backmoney WHERE GUID = #{guid}
	</delete>
	
	<!-- 多选删除 -->
	<delete id="mulDel" parameterType="java.lang.String" flushCache="true">
		DELETE FROM backmoney WHERE GUID IN
		<foreach item="id" collection="array" open="(" separator="," close=")"> 
			#{id}
		</foreach> 
	</delete>
</mapper>
