<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Company">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 条件语句 -->
	<sql id="WhereSQL">
		<where>
			<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
			</if>
			<if test="fullname != null and fullname != ''"> 
			AND T.FULLNAME = #{fullname} 
			</if>
			<if test="shortname != null and shortname != ''"> 
			AND T.SHORTNAME = #{shortname} 
			</if>
			<if test="contactperson != null and contactperson != ''"> 
			AND T.CONTACTPERSON = #{contactperson} 
			</if>
			<if test="createtime != null and createtime != ''"> 
			AND T.CREATETIME = #{createtime} 
			</if>
			<if test="companytype != null and companytype != ''"> 
			AND T.COMPANYTYPE = #{companytype} 
			</if>
		</where>
	</sql>
	
	<!-- 查找语句 -->
	<select id="find" resultType="Company" parameterType="Company" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.FULLNAME AS fullname, 
	    	T.SHORTNAME AS shortname, 
	    	T.CONTACTPERSON AS contactperson, 
	    	T.CREATETIME AS createtime, 
	    	T.COMPANYTYPE AS companytype 
    	FROM company T
		<include refid="WhereSQL" /> 
		ORDER BY T.CREATETIME DESC
	</select>
	
	<!-- 获取总记录数语句 -->
	<select id="findCount" resultType="java.lang.Integer" parameterType="Company" flushCache="false" useCache="true">
    	SELECT COUNT(*)  FROM company T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 插入语句 -->
	<insert id="insert" parameterType="Company" flushCache="true"> 
		INSERT INTO company
		(
			GUID, 
			FULLNAME, 
			SHORTNAME, 
			CONTACTPERSON, 
			CREATETIME, 
			COMPANYTYPE 
		 ) 
		VALUES
		(
			#{guid,jdbcType=VARCHAR}, 
			#{fullname,jdbcType=VARCHAR}, 
			#{shortname,jdbcType=VARCHAR}, 
			#{contactperson,jdbcType=VARCHAR}, 
			#{createtime,jdbcType=TIMESTAMP}, 
			#{companytype,jdbcType=VARCHAR} 
		) 
	</insert>
	
	<!-- 更新语句 -->
	<update id="update"  parameterType="Company" flushCache="true"> 
		update company 
		<set> 
			<if test="guid != null">GUID=#{guid},</if>
			<if test="fullname != null">FULLNAME=#{fullname},</if>
			<if test="shortname != null">SHORTNAME=#{shortname},</if>
			<if test="contactperson != null">CONTACTPERSON=#{contactperson},</if>
			<if test="createtime != null">CREATETIME=#{createtime},</if>
			<if test="companytype != null">COMPANYTYPE=#{companytype},</if>
		</set>
		WHERE GUID = #{guid}
	</update> 
	
	<!-- 单选删除语句 -->
	<delete id="delete" parameterType="Company" flushCache="true"> 
		DELETE FROM company WHERE GUID = #{guid}
	</delete>
	
	<!-- 多选删除 -->
	<delete id="mulDel" parameterType="java.lang.String" flushCache="true">
		DELETE FROM company WHERE GUID IN
		<foreach item="id" collection="array" open="(" separator="," close=")"> 
			#{id}
		</foreach> 
	</delete>
	
	
	<select id="findDetail" resultMap="companyDetail" parameterType="Users" flushCache="false" useCache="true">
    	select 
    		c.guid as cguid,
	    	r.type as rtype ,
	    	c.fullname as fullname ,
	    	c.shortname as shortname,
	    	c.contactperson as person   
	    	from  roles r left join company c 
	    	on r.companyid=c.guid 
			where r.userguid=#{guid}  
			and c.companytype=#{companytype} 
	</select>
	<select id="findDetailCount" resultType="java.lang.Integer" parameterType="Users" flushCache="false" useCache="true">
    	SELECT COUNT(r.type)  FROM   roles r left join company c 
	    	on r.companyid=c.guid 
			where r.userguid=#{guid};
	</select>
	
	<resultMap type="CompanyResult" id="companyDetail">
		<id property="guid" column="cguid"/>
		<result property="type" column="rtype"/>
		<result property="fullname" column="fullname"/>
		<result property="shortname" column="shortname"/>
		<result property="contactperson" column="person"/>
	</resultMap>
	
	
</mapper>
