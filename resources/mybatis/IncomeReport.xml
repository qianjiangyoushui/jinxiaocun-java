<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="IncomeReport">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 查找语句 -->
	<select id="incomeReport" resultType="IncomeReport" parameterType="IncomeReport" flushCache="false" useCache="true">
    	select  
		T.stockcompany as stockcompany ,
		c.shortname as shortname,
		T.supplycompany as supplycompany,
		T.starttime as starttime,
		T.endtime as endtime,
		T.coaltype as coaltype,
		T.coalquality as coalquality,
		IFNULL(sum(i.interest),0) as interest,
		IFNULL(sum(i.overdue),0) as overdue,
		IFNULL(sum(i.otherincome),0) as otherincome ,
		IFNULL(sum(s.setmentamount),0) as setmentamount 
		from projects T 
		left join incomes i 
		on T.guid=i.projectid 
		left join settlement s 
		on T.guid=s.projectid 
		left join company c 
		on T.companyid=c.guid 
		where T.companyid=#{companyid} 
		group by T.guid 
	</select>
	
</mapper>
