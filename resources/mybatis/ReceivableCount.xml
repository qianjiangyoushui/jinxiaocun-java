<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReceivableCount">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 查找语句 -->
	<select id="receivableCount" resultType="ReceivableCount" parameterType="ReceivableCount" flushCache="false" useCache="true">
    	select  
		c.shortname as stockcompany ,
		co.shortname as shortname,
		IFNULL(sum(s.setmentamount),0) as sumamount,
		IFNULL(sum(s.money),0) as summoney,
		IFNULL((select sum(b.backmoney)  from backmoney b where 
				b.stockcompanyid=p.stockcompanyid and b.companyid=#{companyid} group by b.stockcompanyid),0) as backmoney 
		from projects p           
		left join   company c
		on c.guid =p.stockcompanyid 
		left join settlement s 
		on p.guid =s.projectid 
		left join company co 
		on p.companyid =co.guid 
		where p.companyid=#{companyid}  
		group by stockcompany,shortname 
	</select>
	
</mapper>
