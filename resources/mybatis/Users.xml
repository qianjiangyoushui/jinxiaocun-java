<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Users">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 条件语句 -->
	<sql id="WhereSQL">
		<where>
			<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
			</if>
			<if test="phone != null and phone != ''"> 
			AND T.PHONE = #{phone} 
			</if>
			<if test="password != null and password != ''"> 
			AND T.PASSWORD = #{password} 
			</if>
			<if test="createtime != null and createtime != ''"> 
			AND T.CREATETIME = #{createtime} 
			</if>
			<if test="type != null and type != ''"> 
			AND T.TYPE = #{type} 
			</if>
			<if test="parentid != null and parentid != ''"> 
			AND T.PARENTID = #{parentid} 
			</if>
			<if test="openid != null and openid != ''"> 
			AND T.OPENID = #{openid} 
			</if>
			<if test="contactperson != null and contactperson != ''"> 
			AND T.CONTACTPERSON = #{contactperson} 
			</if>
		</where>
	</sql>
	
	<!-- 查找语句 -->
	<select id="find" resultType="Users" parameterType="Users" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.PHONE AS phone, 
	    	T.PASSWORD AS password, 
	    	T.CREATETIME AS createtime, 
	    	T.TYPE AS type, 
	    	T.PARENTID AS parentid, 
	    	T.OPENID AS openid, 
	    	T.CONTACTPERSON AS contactperson 
    	FROM users T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 获取总记录数语句 -->
	<select id="findCount" resultType="java.lang.Integer" parameterType="Users" flushCache="false" useCache="true">
    	SELECT COUNT(*)  FROM users T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 插入语句 -->
	<insert id="insert" parameterType="Users" flushCache="true"> 
		INSERT INTO users
		(
			GUID, 
			PHONE, 
			PASSWORD, 
			CREATETIME, 
			TYPE, 
			PARENTID, 
			OPENID, 
			CONTACTPERSON 
		 ) 
		VALUES
		(
			#{guid,jdbcType=VARCHAR}, 
			#{phone,jdbcType=VARCHAR}, 
			#{password,jdbcType=VARCHAR}, 
			#{createtime,jdbcType=TIMESTAMP}, 
			#{type,jdbcType=VARCHAR}, 
			#{parentid,jdbcType=VARCHAR}, 
			#{openid,jdbcType=VARCHAR}, 
			#{contactperson,jdbcType=VARCHAR} 
		) 
	</insert>
	
	<!-- 更新语句 -->
	<update id="update"  parameterType="Users" flushCache="true"> 
		update users 
		<set> 
			<if test="guid != null">GUID=#{guid},</if>
			<if test="phone != null">PHONE=#{phone},</if>
			<if test="password != null">PASSWORD=#{password},</if>
			<if test="createtime != null">CREATETIME=#{createtime},</if>
			<if test="type != null">TYPE=#{type},</if>
			<if test="parentid != null">PARENTID=#{parentid},</if>
			<if test="openid != null">OPENID=#{openid},</if>
			<if test="contactperson != null">CONTACTPERSON=#{contactperson},</if>
		</set>
		WHERE GUID = #{guid}
	</update> 
	
	<!-- 单选删除语句 -->
	<delete id="delete" parameterType="Users" flushCache="true"> 
		DELETE FROM users WHERE GUID = #{guid}
	</delete>
	
	<!-- 多选删除 -->
	<delete id="mulDel" parameterType="java.lang.String" flushCache="true">
		DELETE FROM users WHERE GUID IN
		<foreach item="id" collection="array" open="(" separator="," close=")"> 
			#{id}
		</foreach> 
	</delete>
	
<!-- 	查找操作员 -->
	<select id="findOperate" resultType="Users" parameterType="Company" flushCache="false" useCache="true">
    	select 
        u.guid as guid ,
        u.contactperson as contactperson ,
        u.phone as phone 
        from users u left join roles r 
        on u.guid=r.userguid 
        where r.companyid=#{guid}  
        and  r.type='2' 
	</select>
	
	<select id="findCountOperate" resultType="java.lang.Integer" parameterType="Company" flushCache="false" useCache="true">
    	SELECT COUNT(*)  from users u left join roles r 
        on u.guid=r.userguid 
        where r.companyid=#{guid}  
        and  r.type='2'
	</select>
	
	<select id="findManager" resultType="Users" parameterType="Company" flushCache="false" useCache="true">
    	select 
    	u.guid as guid ,
    	u.phone as phone ,
    	u.contactperson as contactperson  
    	from users u left join roles r 
    	on u.guid=r.userguid 
    	where r.companyid=#{guid}
	</select>
	
	<!-- 查找语句 -->
	<select id="findMsgPer" resultType="Users" parameterType="Rolepart" flushCache="false" useCache="true">
    	select 
			u.guid as guid,
			u.openid as openid 
			from users u 
			left join rolepart r 
			on u.guid =r.userguid 
			where r.rolepart=#{rolepart} 
			and r.companyid=#{companyid} 
	</select>
</mapper>
