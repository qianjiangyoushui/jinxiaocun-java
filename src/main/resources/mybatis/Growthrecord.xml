<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Growthrecord">

    <!-- 缓存条数 -->
    <cache size="2000" />

    <!-- 条件语句 -->
    <sql id="WhereSQL">
        <where>
            <if test="guid != null and guid != ''">
                AND T.GUID = #{guid}
            </if>
             <if test="guids != null and guids != ''">
                AND T.GUID IN
                 <foreach item="id" collection="guids" open="(" separator="," close=")">
                     #{id}
                 </foreach>
            </if>
            <if test="companyid != null and companyid != ''">
                AND T.COMPANYID = #{companyid}
            </if>
            <if test="userid != null and userid != ''">
                AND T.USERID = #{userid}
            </if>
            <if test="batchid != null and batchid != ''">
                AND T.BATCHID = #{batchid}
            </if>
            <if test="content != null and content != ''">
                AND T.CONTENT = #{content}
            </if>
            <if test="step != null and step != ''">
                AND T.STEP = #{step}
            </if>
            <if test="type != null and type != ''">
                AND T.TYPE = #{type}
            </if>
            <if test="month != null and month != ''">
                AND T.MONTH = #{month}
            </if>
            <if test="day != null and day != ''">
                AND T.DAY = #{day}
            </if>
            <if test="visible != null and visible != ''">
                AND T.VISIBLE = #{visible}
            </if>
            <if test="createdate != null and createdate != ''">
                AND T.CREATEDATE = #{createdate}
            </if>
            <if test="sort != null and sort != ''">
                AND T.SORT = #{sort}
            </if>
        </where>
    </sql>

    <!-- 查找语句 -->
    <select id="find" resultType="Growthrecord" parameterType="Growthrecord" flushCache="false" useCache="true">
        SELECT
        T.GUID AS guid,
        T.COMPANYID AS companyid,
        T.USERID AS userid,
        T.BATCHID AS batchid,
        T.CONTENT AS content,
        T.STEP AS step,
        T.TYPE AS type,
        T.MONTH AS month,
        T.DAY AS day,
        T.PLOT AS plot,
        T.VISIBLE AS visible,
        T.CREATEDATE AS createdate,
        T.SORT AS sort
        FROM growthrecord T
        <include refid="WhereSQL" />
        GROUP BY T.content
        ORDER BY CREATEDATE DESC
    </select>
    <!-- 查找语句 -->
    <select id="findContainImages" resultMap="recordMap" parameterType="Growthrecord" flushCache="false" useCache="true">
        SELECT
        T.GUID AS guid,
        T.COMPANYID AS companyid,
        T.USERID AS userid,
        T.BATCHID AS batchid,
        T.BATCHCODE AS batchcode,
        T.CONTENT AS content,
        T.STEP AS step,
        T.TYPE AS type,
        T.MONTH AS month,
        T.DAY AS day,
        T.PLOT AS plot,
        T.VISIBLE AS visible,
        T.CREATEDATE AS createdate,
        T.SORT AS sort,
        U.GUID AS u_guid,
        U.URL AS url,
        U.URL2 AS url2,
        U.IMAGENAME AS imagename,
        U.RELATEDID AS relatedid,
        U.UPLOADDATE AS uploaddate,
        S.GUID AS s_guid,
        S.USERNAME AS username,
        S.TELPHONE AS telphone
        FROM growthrecord T
        LEFT JOIN upimage U ON T.GUID=U.RELATEDID
        LEFT JOIN USERS S ON T.USERID=S.GUID
        <include refid="WhereSQL" />
        ORDER BY CREATEDATE DESC
    </select>

    <!-- 获取总记录数语句 -->
    <select id="findCount" resultType="java.lang.Integer" parameterType="Growthrecord" flushCache="false" useCache="true">
        SELECT COUNT(*)  FROM growthrecord T
        <include refid="WhereSQL" />
    </select>

    <!-- 插入语句 -->
    <insert id="insert" parameterType="Growthrecord" flushCache="true">
        INSERT INTO growthrecord
        (
        GUID,
        COMPANYID,
        USERID,
        BATCHID,
        BATCHCODE,
        CONTENT,
        STEP,
        TYPE,
        MONTH,
        DAY,
        PLOT,
        VISIBLE,
        CREATEDATE,
        SORT
        )
        VALUES
        (
        #{guid,jdbcType=VARCHAR},
        #{companyid,jdbcType=VARCHAR},
        #{userid,jdbcType=VARCHAR},
        #{batchid,jdbcType=VARCHAR},
        #{batchcode,jdbcType=VARCHAR},
        #{content,jdbcType=VARCHAR},
        #{step,jdbcType=VARCHAR},
        #{type,jdbcType=VARCHAR},
        #{month,jdbcType=VARCHAR},
        #{day,jdbcType=VARCHAR},
        #{plot,jdbcType=VARCHAR},
        #{visible,jdbcType=INTEGER},
        #{createdate,jdbcType=DATE},
        #{sort,jdbcType=INTEGER}
        )
    </insert>

    <!-- 更新语句 -->
    <update id="update"  parameterType="Growthrecord" flushCache="true">
        update growthrecord
        <set>
            <if test="guid != null">GUID=#{guid},</if>
            <if test="companyid != null">COMPANYID=#{companyid},</if>
            <if test="userid != null">USERID=#{userid},</if>
            <if test="batchid != null">BATCHID=#{batchid},</if>
            <if test="batchcode != null">BATCHCODE=#{batchcode},</if>
            <if test="content != null">CONTENT=#{content},</if>
            <if test="step != null">STEP=#{step},</if>
            <if test="type != null">TYPE=#{type},</if>
            <if test="month != null">MONTH=#{month},</if>
            <if test="day != null">DAY=#{day},</if>
            <if test="visible != null">VISIBLE=#{visible},</if>
            <if test="createdate != null">CREATEDATE=#{createdate},</if>
            <if test="sort != null">SORT=#{sort},</if>
        </set>
        WHERE GUID = #{guid}
    </update>

    <!-- 单选删除语句 -->
    <delete id="delete" parameterType="Growthrecord" flushCache="true">
        DELETE FROM growthrecord WHERE GUID = #{guid}
    </delete>

    <!-- 多选删除 -->
    <delete id="mulDel" parameterType="java.lang.String" flushCache="true">
        DELETE FROM growthrecord WHERE GUID IN
        <foreach item="id" collection="array" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    <resultMap id="recordMap" type="Growthrecord">
        <id property="guid" column="guid" />
        <result property="companyid" column="companyid" />
        <result property="userid" column="userid" />
        <result property="batchid" column="batchid" />
        <result property="batchcode" column="batchcode" />
        <result property="content" column="content" />
        <result property="step" column="step" />
        <result property="type" column="type" />
        <result property="month" column="month" />
        <result property="day" column="day" />
        <result property="plot" column="plot" />
        <result property="visible" column="visible" />
        <result property="createdate" column="createdate" />
        <result property="sort" column="sort" />
        <association  property="user" javaType="Users">
            <id property="guid" column="s_guid" />
            <result property="username" column="username" />
            <result property="telphone" column="telphone" />
        </association >
        <collection property="images" ofType="Upimage" javaType="List">
            <id property="guid" column="u_guid" />
            <result property="url" column="url" />
            <result property="url2" column="url2" />
            <result property="imagename" column="imagename" />
            <result property="relatedid" column="relatedid" />
            <result property="uploaddate" column="uploaddate" />
        </collection>
    </resultMap>
</mapper>
