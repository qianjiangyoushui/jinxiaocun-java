<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Tasks">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 条件语句 -->
	<sql id="WhereSQL">
		<where>
			<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
			</if>
			<if test="userid != null and userid != ''"> 
			AND T.USERID = #{userid} 
			</if>
			<if test="workorderid != null and workorderid != ''"> 
			AND T.WORKORDERID = #{workorderid} 
			</if>
			<if test="status != null and status != ''"> 
			AND T.STATUS = #{status} 
			</if>
			<if test="description != null and description != ''"> 
			AND T.DESCRIPTION = #{description} 
			</if>
			<if test="enddate != null and enddate != ''"> 
			AND T.ENDDATE = #{enddate} 
			</if>
		</where>
	</sql>
	
	<!-- 查找语句 -->
	<select id="find" resultType="Tasks" parameterType="Tasks" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.USERID AS userid, 
	    	T.WORKORDERID AS workorderid, 
	    	T.STATUS AS status, 
	    	T.DESCRIPTION AS description, 
	    	T.ENDDATE AS enddate 
    	FROM tasks T
		<include refid="WhereSQL" />
		ORDER BY T.ENDDATE desc
	</select>
	
	<!-- 获取总记录数语句 -->
	<select id="findCount" resultType="java.lang.Integer" parameterType="Tasks" flushCache="false" useCache="true">
    	SELECT COUNT(*)  FROM tasks T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 插入语句 -->
	<insert id="insert" parameterType="Tasks" flushCache="true"> 
		INSERT INTO tasks
		(
			GUID, 
			USERID, 
			WORKORDERID, 
			STATUS, 
			DESCRIPTION, 
			ENDDATE 
		 ) 
		VALUES
		(
			#{guid,jdbcType=VARCHAR}, 
			#{userid,jdbcType=VARCHAR}, 
			#{workorderid,jdbcType=VARCHAR}, 
			#{status,jdbcType=VARCHAR}, 
			#{description,jdbcType=VARCHAR}, 
			#{enddate,jdbcType=DATE} 
		) 
	</insert>
	
	<!-- 更新语句 -->
	<update id="update"  parameterType="Tasks" flushCache="true"> 
		update tasks 
		<set> 
			<if test="guid != null">GUID=#{guid},</if>
			<if test="userid != null">USERID=#{userid},</if>
			<if test="workorderid != null">WORKORDERID=#{workorderid},</if>
			<if test="status != null">STATUS=#{status},</if>
			<if test="description != null">DESCRIPTION=#{description},</if>
			<if test="enddate != null">ENDDATE=#{enddate},</if>
		</set>
		WHERE GUID = #{guid}
	</update> 
	
	<!-- 单选删除语句 -->
	<delete id="delete" parameterType="Tasks" flushCache="true"> 
		DELETE FROM tasks WHERE GUID = #{guid}
	</delete>
	
	<!-- 多选删除 -->
	<delete id="mulDel" parameterType="java.lang.String" flushCache="true">
		DELETE FROM tasks WHERE GUID IN
		<foreach item="id" collection="array" open="(" separator="," close=")"> 
			#{id}
		</foreach> 
	</delete>
	
	
    <!-- 查找语句 -->
	<select id="findList" resultMap="resultList" parameterType="Tasks" flushCache="false" useCache="true">
    	SELECT 
	    	w.GUID AS w_guid, 
	    	w.ORDERNAME AS ordername, 
	    	w.STARTDATE AS startdate, 
	    	w.ENDDATE AS w_enddate, 
	    	w.PRINCIPAL AS principal, 
	    	w.TASKREQUEST AS taskrequest, 
	    	w.CREATEDATE AS createdate, 
	    	w.USERID AS w_userid, 
	    	w.PARTIC AS partic, 
	    	w.STATUS AS w_status,
	    	
	    	T.GUID AS guid, 
	    	T.USERID AS userid, 
	    	T.WORKORDERID AS workorderid,
	    	T.STATUS AS status, 
	    	T.DESCRIPTION AS description, 
	    	T.ENDDATE AS enddate 
    	FROM tasks T
    	LEFT JOIN workorder w on w.guid = T.workorderid
    	where 1=1
		<if test="userid != null and userid != ''"> 
			AND T.USERID = #{userid} 
		</if>
		<if test="date != null and date != ''"> 
			AND w.STARTDATE = #{date} 
		</if>
		<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
		</if>
		ORDER BY w.CREATEDATE desc
	</select>
	
	
	<resultMap type="Tasks" id="resultList">
			<id property="guid" column="guid" />
			<result property="userid" column="userid" />
			<result property="workorderid" column="workorderid" />
			<result property="status" column="status" />
			<result property="description" column="description" />
			<result property="enddate" column="enddate" />
		
		
		<association property="workorder" javaType="workorder">
			<id property="guid" column="w_guid" />
			<result property="ordername" column="ordername" />
			<result property="startdate" column="startdate" />
			<result property="enddate" column="w_enddate" />
			<result property="principal" column="principal" />
			<result property="taskrequest" column="taskrequest" />
			<result property="createdate" column="createdate" />
			<result property="userid" column="w_userid" />
			<result property="partic" column="partic" />
			<result property="status" column="w_status" />
		</association>
		
	</resultMap>
</mapper>
