<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Yieldtest">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 条件语句 -->
	<sql id="WhereSQL">
		<where>
			<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
			</if>
			<if test="seedfileid != null and seedfileid != ''"> 
			AND T.SEEDFILEID = #{seedfileid} 
			</if>
			<if test="testdate != null and testdate != ''"> 
			AND T.TESTDATE = #{testdate} 
			</if>
			<if test="level != null and level != ''"> 
			AND T.LEVEL = #{level} 
			</if>
			<if test="project != null and project != ''"> 
			AND T.PROJECT = #{project} 
			</if>
			<if test="munumber != null and munumber != ''"> 
			AND T.MUNUMBER = #{munumber} 
			</if>
			<if test="plantnumber != null and plantnumber != ''"> 
			AND T.PLANTNUMBER = #{plantnumber} 
			</if>
			<if test="rhizomenumber != null and rhizomenumber != ''"> 
			AND T.RHIZOMENUMBER = #{rhizomenumber} 
			</if>
			<if test="bigamount != null and bigamount != ''"> 
			AND T.BIGAMOUNT = #{bigamount} 
			</if>
			<if test="bigweight != null and bigweight != ''"> 
			AND T.BIGWEIGHT = #{bigweight} 
			</if>
			<if test="mediumamount != null and mediumamount != ''"> 
			AND T.MEDIUMAMOUNT = #{mediumamount} 
			</if>
			<if test="mediumweight != null and mediumweight != ''"> 
			AND T.MEDIUMWEIGHT = #{mediumweight} 
			</if>
			<if test="minamount != null and minamount != ''"> 
			AND T.MINAMOUNT = #{minamount} 
			</if>
			<if test="minweight != null and minweight != ''"> 
			AND T.MINWEIGHT = #{minweight} 
			</if>
			<if test="amount != null and amount != ''"> 
			AND T.AMOUNT = #{amount} 
			</if>
			<if test="weight != null and weight != ''"> 
			AND T.WEIGHT = #{weight} 
			</if>
			<if test="permu != null and permu != ''"> 
			AND T.PERMU = #{permu} 
			</if>
			<if test="avgperstrain != null and avgperstrain != ''"> 
			AND T.AVGPERSTRAIN = #{avgperstrain} 
			</if>
			<if test="testperson != null and testperson != ''"> 
			AND T.TESTPERSON = #{testperson} 
			</if>
			<if test="createdate != null and createdate != ''"> 
			AND T.CREATEDATE = #{createdate} 
			</if>
			<if test="operatorid != null and operatorid != ''"> 
			AND T.OPERATORID = #{operatorid} 
			</if>
		</where>
	</sql>
	
	<!-- 查找语句 -->
	<select id="find" resultType="Yieldtest" parameterType="Yieldtest" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.SEEDFILEID AS seedfileid, 
	    	T.TESTDATE AS testdate, 
	    	T.LEVEL AS level, 
	    	T.PROJECT AS project, 
	    	T.MUNUMBER AS munumber, 
	    	T.PLANTNUMBER AS plantnumber, 
	    	T.RHIZOMENUMBER AS rhizomenumber, 
	    	T.BIGAMOUNT AS bigamount, 
	    	T.BIGWEIGHT AS bigweight, 
	    	T.MEDIUMAMOUNT AS mediumamount, 
	    	T.MEDIUMWEIGHT AS mediumweight, 
	    	T.MINAMOUNT AS minamount, 
	    	T.MINWEIGHT AS minweight, 
	    	T.AMOUNT AS amount, 
	    	T.WEIGHT AS weight, 
	    	T.PERMU AS permu, 
	    	T.AVGPERSTRAIN AS avgperstrain, 
	    	T.TESTPERSON AS testperson, 
	    	T.CREATEDATE AS createdate, 
	    	T.OPERATORID AS operatorid 
    	FROM yieldtest T
		<include refid="WhereSQL" />
		ORDER BY T.CREATEDATE desc
	</select>
	<!-- 查找语句 -->
	<select id="findcount" resultType="java.util.Map" parameterType="Yieldtest" flushCache="false" useCache="true">
    	select 
    	T.munumber as munumber,
    	 count(T.guid) as count,
		avg(T.permu) as avgpermu,
   		FORMAT(avg(T.bigweight)/T.munumber,2) as avgbigsum,
   		FORMAT(avg(T.mediumweight)/T.munumber,2) as avgmedsum,
		FORMAT(avg(T.minweight)/T.munumber,2) as avgminsum  
    	from yieldtest  T 
		<include refid="WhereSQL" />
	</select>
	
	<!-- 获取总记录数语句 -->
	<select id="findCount" resultType="java.lang.Integer" parameterType="Yieldtest" flushCache="false" useCache="true">
    	SELECT COUNT(*)  FROM yieldtest T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 插入语句 -->
	<insert id="insert" parameterType="Yieldtest" flushCache="true"> 
		INSERT INTO yieldtest
		(
			GUID, 
			SEEDFILEID, 
			TESTDATE, 
			LEVEL, 
			PROJECT, 
			MUNUMBER, 
			PLANTNUMBER, 
			RHIZOMENUMBER, 
			BIGAMOUNT, 
			BIGWEIGHT, 
			MEDIUMAMOUNT, 
			MEDIUMWEIGHT, 
			MINAMOUNT, 
			MINWEIGHT, 
			AMOUNT, 
			WEIGHT, 
			PERMU, 
			AVGPERSTRAIN, 
			TESTPERSON, 
			CREATEDATE, 
			OPERATORID 
		 ) 
		VALUES
		(
			#{guid,jdbcType=VARCHAR}, 
			#{seedfileid,jdbcType=VARCHAR}, 
			#{testdate,jdbcType=DATE}, 
			#{level,jdbcType=VARCHAR}, 
			#{project,jdbcType=VARCHAR}, 
			#{munumber,jdbcType=DECIMAL}, 
			#{plantnumber,jdbcType=INTEGER}, 
			#{rhizomenumber,jdbcType=INTEGER}, 
			#{bigamount,jdbcType=INTEGER}, 
			#{bigweight,jdbcType=DECIMAL}, 
			#{mediumamount,jdbcType=INTEGER}, 
			#{mediumweight,jdbcType=DECIMAL}, 
			#{minamount,jdbcType=INTEGER}, 
			#{minweight,jdbcType=DECIMAL}, 
			#{amount,jdbcType=INTEGER}, 
			#{weight,jdbcType=DECIMAL}, 
			#{permu,jdbcType=DECIMAL}, 
			#{avgperstrain,jdbcType=DECIMAL}, 
			#{testperson,jdbcType=VARCHAR}, 
			#{createdate,jdbcType=DATE}, 
			#{operatorid,jdbcType=VARCHAR} 
		) 
	</insert>
	
	<!-- 更新语句 -->
	<update id="update"  parameterType="Yieldtest" flushCache="true"> 
		update yieldtest 
		<set> 
			<if test="guid != null">GUID=#{guid},</if>
			<if test="seedfileid != null">SEEDFILEID=#{seedfileid},</if>
			<if test="testdate != null">TESTDATE=#{testdate},</if>
			<if test="level != null">LEVEL=#{level},</if>
			<if test="project != null">PROJECT=#{project},</if>
			<if test="munumber != null">MUNUMBER=#{munumber},</if>
			<if test="plantnumber != null">PLANTNUMBER=#{plantnumber},</if>
			<if test="rhizomenumber != null">RHIZOMENUMBER=#{rhizomenumber},</if>
			<if test="bigamount != null">BIGAMOUNT=#{bigamount},</if>
			<if test="bigweight != null">BIGWEIGHT=#{bigweight},</if>
			<if test="mediumamount != null">MEDIUMAMOUNT=#{mediumamount},</if>
			<if test="mediumweight != null">MEDIUMWEIGHT=#{mediumweight},</if>
			<if test="minamount != null">MINAMOUNT=#{minamount},</if>
			<if test="minweight != null">MINWEIGHT=#{minweight},</if>
			<if test="amount != null">AMOUNT=#{amount},</if>
			<if test="weight != null">WEIGHT=#{weight},</if>
			<if test="permu != null">PERMU=#{permu},</if>
			<if test="avgperstrain != null">AVGPERSTRAIN=#{avgperstrain},</if>
			<if test="testperson != null">TESTPERSON=#{testperson},</if>
			<if test="createdate != null">CREATEDATE=#{createdate},</if>
			<if test="operatorid != null">OPERATORID=#{operatorid},</if>
		</set>
		WHERE GUID = #{guid}
	</update> 
	
	<!-- 单选删除语句 -->
	<delete id="delete" parameterType="Yieldtest" flushCache="true"> 
		DELETE FROM yieldtest WHERE GUID = #{guid}
	</delete>
	
	<!-- 多选删除 -->
	<delete id="mulDel" parameterType="java.lang.String" flushCache="true">
		DELETE FROM yieldtest WHERE GUID IN
		<foreach item="id" collection="array" open="(" separator="," close=")"> 
			#{id}
		</foreach> 
	</delete>
	
	
	<!-- 查找语句 -->
	<select id="findSum" resultType="Yieldtest" parameterType="Yieldtest" flushCache="false" useCache="true">
    	SELECT
			count(*) AS num,
			IFNULL(s.strainamount, 0) AS strainamount,
			IFNULL(sum(t.plantnumber), 0) AS plantnumber,
			<!-- IFNULL(avg(t.avgperstrain), 0) AS avgperstrain, -->
			IFNULL(t.munumber, 10) AS munumber,
			FORMAT(IFNULL((sum(t.bigweight) + sum(t.mediumweight) +sum(t.minweight))/ (sum(t.bigamount) + sum(t.mediumamount) + sum(t.minamount)),0),2) AS avgperstrain,
			FORMAT(IFNULL(strainamount * IFNULL((sum(t.bigweight) + sum(t.mediumweight) +sum(t.minweight))/ (sum(t.bigamount) + sum(t.mediumamount) + sum(t.minamount)),0), 0),2) AS batchSum,
			IFNULL(sum(t.bigweight), 0) AS bigweight,
			IFNULL(sum(t.mediumweight), 0) AS mediumweight,
			IFNULL(sum(t.minweight), 0) AS minweight
		FROM
			yieldtest t
		LEFT JOIN seedfile s ON t.seedfileid = s.guid
		WHERE 1 = 1
		<if test="seedfileid != null and seedfileid != ''"> 
			AND t.seedfileid= #{seedfileid} 
		</if>
	</select>
	
	
</mapper>
