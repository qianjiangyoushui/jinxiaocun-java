<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Greenhouses">
	
	<!-- 缓存条数 -->
	<cache size="2000" />
	
	<!-- 条件语句 -->
	<sql id="WhereSQL">
		<where>
			<if test="guid != null and guid != ''"> 
			AND T.GUID = #{guid} 
			</if>
			<if test="companyid != null and companyid != ''"> 
			AND T.COMPANYID = #{companyid} 
			</if>
			<if test="housename != null and housename != ''"> 
			AND T.HOUSENAME = #{housename} 
			</if>
			<if test="distance != null and distance != ''"> 
			AND T.DISTANCE = #{distance} 
			</if>
			<if test="areas != null and areas != ''"> 
			AND T.AREAS = #{areas} 
			</if>
			<if test="amount != null and amount != ''"> 
			AND T.AMOUNT = #{amount} 
			</if>
			<if test="description != null and description != ''"> 
			AND T.DESCRIPTION = #{description} 
			</if>
			<if test="createdate != null and createdate != ''"> 
			AND T.CREATEDATE = #{createdate} 
			</if>
			<if test="operatorid != null and operatorid != ''"> 
			AND T.OPERATORID = #{operatorid} 
			</if>
			<if test="url != null and url != ''"> 
			AND T.url = #{url} 
			</if>
		</where>
	</sql>
	
	<!-- 查找语句 -->
	<select id="find" resultType="Greenhouses" parameterType="Greenhouses" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.COMPANYID AS companyid, 
	    	T.HOUSENAME AS housename, 
	    	T.DISTANCE AS distance, 
	    	T.AREAS AS areas, 
	    	T.AMOUNT AS amount, 
	    	T.DESCRIPTION AS description, 
	    	T.CREATEDATE AS createdate, 
	    	T.OPERATORID AS operatorid ,
	    	T.url as url 
    	FROM greenhouses T
		<include refid="WhereSQL" />
		ORDER BY createdate desc
	</select>
	
	<!-- 获取总记录数语句 -->
	<select id="findCount" resultType="java.lang.Integer" parameterType="Greenhouses" flushCache="false" useCache="true">
    	SELECT COUNT(*)  FROM greenhouses T
		<include refid="WhereSQL" />
	</select>
	
	<!-- 插入语句 -->
	<insert id="insert" parameterType="Greenhouses" flushCache="true"> 
		INSERT INTO greenhouses
		(
			GUID, 
			COMPANYID, 
			HOUSENAME, 
			DISTANCE, 
			AREAS, 
			AMOUNT, 
			DESCRIPTION, 
			CREATEDATE, 
			OPERATORID ,
			url 
		 ) 
		VALUES
		(
			#{guid,jdbcType=VARCHAR}, 
			#{companyid,jdbcType=VARCHAR}, 
			#{housename,jdbcType=VARCHAR}, 
			#{distance,jdbcType=DECIMAL}, 
			#{areas,jdbcType=DECIMAL}, 
			#{amount,jdbcType=INTEGER}, 
			#{description,jdbcType=VARCHAR}, 
			#{createdate,jdbcType=DATE}, 
			#{operatorid,jdbcType=VARCHAR} ,
			#{url,jdbcType=VARCHAR} 
		) 
	</insert>
	
	<!-- 更新语句 -->
	<update id="update"  parameterType="Greenhouses" flushCache="true"> 
		update greenhouses 
		<set> 
			<if test="guid != null">GUID=#{guid},</if>
			<if test="companyid != null">COMPANYID=#{companyid},</if>
			<if test="housename != null">HOUSENAME=#{housename},</if>
			<if test="distance != null">DISTANCE=#{distance},</if>
			<if test="areas != null">AREAS=#{areas},</if>
			<if test="amount != null">AMOUNT=#{amount},</if>
			<if test="description != null">DESCRIPTION=#{description},</if>
			<if test="createdate != null">CREATEDATE=#{createdate},</if>
			<if test="operatorid != null">OPERATORID=#{operatorid},</if>
			<if test="url != null">url=#{url},</if>
		</set>
		WHERE GUID = #{guid}
	</update> 
	
	<!-- 单选删除语句 -->
	<delete id="delete" parameterType="Greenhouses" flushCache="true"> 
		DELETE FROM greenhouses WHERE GUID = #{guid}
	</delete>
	
	<!-- 多选删除 -->
	<delete id="mulDel" parameterType="java.lang.String" flushCache="true">
		DELETE FROM greenhouses WHERE GUID IN
		<foreach item="id" collection="array" open="(" separator="," close=")"> 
			#{id}
		</foreach> 
	</delete>
	
	
	
	<select id="findList" resultMap="resultList" parameterType="Greenhouses" flushCache="false" useCache="true">
    	SELECT 
	    	T.GUID AS guid, 
	    	T.COMPANYID AS companyid, 
	    	T.HOUSENAME AS housename, 
	    	T.DISTANCE AS distance, 
	    	T.AREAS AS areas, 
	    	T.AMOUNT AS amount, 
	    	T.DESCRIPTION AS description, 
	    	T.CREATEDATE AS createdate, 
	    	T.OPERATORID AS operatorid ,
	    	T.url as url,
	    	s.GUID AS s_guid,
			s.COMPANYID AS s_companyid,
			s.BATCH AS batch,
			s.VARIETY AS variety,
			s.LEVEL AS level,
			s.SEEDID AS seedid,
			s.PLACEID AS placeid,
			s.YEARS AS years,
			s.STARTDATE AS startdate,
			s.ENDDATE AS enddate,
			s.BOTTLEAMOUNT AS bottleamount,
			s.STRAINAMOUNT AS strainamount,
			s.STUBBLE AS stubble,
			s.STOPWATERDATE AS stopwaterdate,
			s.KILLDATE AS killdate,
			s.REWARDDATE AS rewarddate,
			s.STOPMUCK AS stopmuck,
			s.BUDDINGDATE AS buddingdate,
			s.MUAMOUNT AS muamount,
			s.TYPE AS type,
			s.CODE AS code,
			s.DESCRIPTION AS s_description,
			s.VISIBLE AS visible,
			s.CREATEDATE AS s_createdate,
			s.OPERATORID AS s_operatorid ,
			d.guid as d_guid,
			d.belongsname as d_belongsname,
			d.keyvalue as d_keyvalue,
			d2.guid as d2_guid,
			d2.belongsname as d2_belongsname,
			d2.keyvalue as d2_keyvalue 
<!-- 			u.guid as u_guid, -->
<!-- 			u.url as url  -->
    	FROM greenhouses T 
    	left join seedfile s 
    	on T.guid = s.placeid 
    	left join dictionary d
		on s.variety =d.keyvalue and d.belongsid='2'
		left join dictionary d2
		on s.level =d2.keyvalue and d2.belongsid='3' 
<!-- 		left join upimage u  -->
<!-- 		on T.guid = u.relatedid  -->
		<include refid="WhereSQL" />
<!-- 		and s.rewarddate is null -->
		ORDER BY T.CREATEDATE desc ,s.YEARS desc 
	</select>
	
	
	
	<resultMap type="Greenhouses" id="resultList">
		<id property="guid" column="guid" />
		<result property="companyid" column="companyid" />
		<result property="housename" column="housename" />
		<result property="distance" column="distance" />
		<result property="areas" column="areas" />
		<result property="amount" column="amount" />
		<result property="description" column="description" />
		<result property="createdate" column="createdate" />
		<result property="operatorid" column="operatorid" />
		<result property="url" column="url" />
		
		<collection property="seedfiles" ofType="Seedfile">
			<id property="guid" column="s_guid" />
			<result property="companyid" column="s_companyid" />
			<result property="batch" column="batch" />
			<result property="variety" column="variety" />
			<result property="level" column="level" />
			<result property="seedid" column="seedid" />
			<result property="placeid" column="placeid" />
			<result property="years" column="years" />
			<result property="startdate" column="startdate" />
			<result property="enddate" column="enddate" />
			<result property="bottleamount" column="bottleamount" />
			<result property="strainamount" column="strainamount" />
			<result property="stubble" column="stubble" />
			<result property="stopwaterdate" column="stopwaterdate" />
			<result property="killdate" column="killdate" />
			<result property="rewarddate" column="rewarddate" />
			<result property="stopmuck" column="stopmuck" />
			<result property="buddingdate" column="buddingdate" />
			<result property="muamount" column="muamount" />
			<result property="type" column="type" />
			<result property="code" column="code" />
			<result property="description" column="description" />
			<result property="visible" column="visible" />
			<result property="createdate" column="s_createdate" />
			<result property="operatorid" column="s_operatorid" />
			
			<association property="varietys" javaType="Dictionary">
				<id property="guid" column="d_guid" />
				<result property="belongsname" column="d_belongsname" />
				<result property="keyvalue" column="d_keyvalue" />
			</association>
			<association property="levels" javaType="Dictionary">
				<id property="guid" column="d2_guid" />
				<result property="belongsname" column="d2_belongsname" />
				<result property="keyvalue" column="d2_keyvalue" />
			</association>
		</collection>
		
<!-- 		<collection property="images" ofType="Upimage"> -->
<!-- 			<id property="guid" column="u_guid" /> -->
<!-- 			<result property="url" column="url" /> -->
<!-- 		</collection> -->
	</resultMap>
	
</mapper>
